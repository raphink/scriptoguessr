<!DOCTYPE html>
<html>
<head>
    <title>Bible Guessr</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .verse-text {
            font-size: 1.2rem;
            font-family: Georgia, serif;
        }
    </style>
</head>
<body>
    <div class="container py-4">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h3 class="mb-0">Bible Guessr</h3>
                <span class="badge bg-primary" id="score">Score: 0</span>
            </div>
            
            <div class="card-body">
                <!-- Loading spinner -->
                <div id="loading" class="text-center py-5">
                    <div class="spinner-border" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>

                <!-- Main game content -->
                <div id="game-content" style="display: none;">
                    <!-- Verse display -->
                    <div class="bg-light p-4 rounded mb-4">
                        <p class="verse-text mb-0" id="verse-text"></p>
                    </div>

                    <!-- Guess form -->
                    <form id="guess-form">
                        <div class="mb-3">
                            <label for="book" class="form-label">Book</label>
                            <input type="text" class="form-control" id="book" list="bible-books" required>
                            <datalist id="bible-books"></datalist>
                        </div>

                        <div class="row mb-3">
                            <div class="col">
                                <label for="chapter" class="form-label">Chapter</label>
                                <input type="number" class="form-control" id="chapter" min="1" required>
                            </div>
                            <div class="col">
                                <label for="verse" class="form-label">Verse</label>
                                <input type="number" class="form-control" id="verse" min="1" required>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary w-100" id="submit-btn">Submit Guess</button>
                    </form>

                    <!-- Result alert -->
                    <div class="alert alert-info mt-3" id="result" style="display: none;">
                        <p class="mb-1" id="result-text"></p>
                        <button class="btn btn-success w-100 mt-2" id="next-btn">Next Verse</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- jQuery and Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        const BOOKS = [
            'Genesis', 'Exodus', 'Leviticus', 'Numbers', 'Deuteronomy',
            'Joshua', 'Judges', 'Ruth', '1 Samuel', '2 Samuel',
            '1 Kings', '2 Kings', '1 Chronicles', '2 Chronicles',
            'Ezra', 'Nehemiah', 'Esther', 'Job', 'Psalms',
            'Proverbs', 'Ecclesiastes', 'Song of Solomon', 'Isaiah',
            'Jeremiah', 'Lamentations', 'Ezekiel', 'Daniel', 'Hosea',
            'Joel', 'Amos', 'Obadiah', 'Jonah', 'Micah', 'Nahum',
            'Habakkuk', 'Zephaniah', 'Haggai', 'Zechariah', 'Malachi',
            'Matthew', 'Mark', 'Luke', 'John', 'Acts',
            'Romans', '1 Corinthians', '2 Corinthians', 'Galatians',
            'Ephesians', 'Philippians', 'Colossians', '1 Thessalonians',
            '2 Thessalonians', '1 Timothy', '2 Timothy', 'Titus',
            'Philemon', 'Hebrews', 'James', '1 Peter', '2 Peter',
            '1 John', '2 John', '3 John', 'Jude', 'Revelation'
        ];

        let currentVerse = null;
        let score = 0;

        // Populate datalist with Bible books
        $(document).ready(() => {
            BOOKS.forEach(book => {
                $('#bible-books').append(`<option value="${book}">`);
            });
            fetchRandomVerse();
        });

        async function fetchRandomVerse() {
            $('#loading').show();
            $('#game-content').hide();
            $('#result').hide();
            
            try {
                // Get random book and chapter/verse numbers
                const randomBook = BOOKS[Math.floor(Math.random() * BOOKS.length)];
                const randomChapter = Math.floor(Math.random() * 20) + 1;
                const randomVerse = Math.floor(Math.random() * 30) + 1;

                // Fetch the verse
                const response = await fetch(
                    `https://bible-api.com/${randomBook}+${randomChapter}:${randomVerse}`
                );
                const data = await response.json();

                if (data.error) {
                    // If verse doesn't exist, try again
                    return fetchRandomVerse();
                }

                currentVerse = {
                    text: data.text.trim(),
                    book: randomBook,
                    chapter: randomChapter,
                    verse: randomVerse
                };

                $('#verse-text').text(currentVerse.text);
                $('#loading').hide();
                $('#game-content').show();
                
                // Reset form
                $('#guess-form')[0].reset();
                
            } catch (error) {
                console.error('Error fetching verse:', error);
                $('#verse-text').text('Error loading verse. Please refresh the page.');
            }
        }

        function calculateScore(guess) {
            let points = 0;
            if (guess.book.toLowerCase() === currentVerse.book.toLowerCase()) points += 5;
            if (Number(guess.chapter) === currentVerse.chapter) points += 3;
            if (Number(guess.verse) === currentVerse.verse) points += 2;
            return points;
        }

        // Handle form submission
        $('#guess-form').on('submit', function(e) {
            e.preventDefault();
            
            const guess = {
                book: $('#book').val(),
                chapter: Number($('#chapter').val()),
                verse: Number($('#verse').val())
            };

            const pointsEarned = calculateScore(guess);
            score += pointsEarned;
            
            // Update score display
            $('#score').text(`Score: ${score}`);

            // Show result
            $('#result-text').html(
                `Correct reference: ${currentVerse.book} ${currentVerse.chapter}:${currentVerse.verse}<br>` +
                `Points earned: ${pointsEarned}`
            );
            $('#result').show();
            
            // Disable form
            $('#guess-form input, #submit-btn').prop('disabled', true);
        });

        // Handle next verse button
        $('#next-btn').on('click', function() {
            // Enable form
            $('#guess-form input, #submit-btn').prop('disabled', false);
            fetchRandomVerse();
        });
    </script>
</body>
</html>